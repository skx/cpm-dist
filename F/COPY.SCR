\ Filecopy - Information                                971228es                                                                A simple filecopy utility to demonstrate the use of the         buffered disk functions READ-CHAR and WRITE-CHAR.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               \ Filecopy - Load screen                                971228esFORTH DEFINITIONS  DECIMAL                                      APPLICATION                                                                                                                     2 LOAD                          \ compile program                                                                               TURNKEY COPY COPY.COM           \ create turnkey application                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    \ Filecopy - INFILE OUTFILE HELP ERROR                  971228es                                                                \ Create file handles for input and output                      1 FILE INFILE      \ use buffer 1                               2 FILE OUTFILE     \ use buffer 2                                                                                               \ Show help and exit                                            : HELP  ( -- )                                                    1 ABORT" Usage: A>copy file1 file2 <cr>" ;                                                                                    \ Encountered file error, display filename and quit             : ERROR  ( -- )  FILENAME TYPE  ABORT ;                         -->                                                                                                                                                                                                                                                             \ Filecopy - CMD ARG                                    971228es\ Parse the CP/M command line for the n'th blank delimited      \ parameter.  Return the address and length and a true flag if  \ found, otherwise return false.                                : CMD  ( n -- adr u -1 | 0 )                                      0 0 ROT  128 COUNT  ROT 0 ?DO                                     2SWAP 2DROP                                                     BL SKIP  2DUP BL SCAN                                           ROT OVER -  ROT ROT                                           LOOP  2DROP                                                     DUP IF -1 ELSE AND THEN ;                                                                                                     \ Get argument - if none show help                              : ARG ( n -- adr u )                                              CMD 0= IF ( none ) HELP THEN ;                                -->                                                             \ Filecopy - OPEN-FILES COPY-ALL                        971228es                                                                \ Open source and destination files                             : OPEN-FILES  ( -- )                                              INFILE   1 ARG  OPEN-FILE   IF ." Can't open: "   ERROR THEN    OUTFILE  2 ARG  CREATE-FILE IF ." Can't create: " ERROR THEN ;                                                                \ Copy loop                                                     : COPY-ALL ( -- )                                                 BEGIN                                                             INFILE  READ-CHAR 0=                                          WHILE                                                             OUTFILE  WRITE-CHAR                                             ABORT" Error; probably out of disk space"                     REPEAT DROP ;                                                 -->                                                             \ Filecopy - CLOSE-FILES COPY                           971228es                                                                \ Close source and destination files                            : CLOSE-FILES  ( -- )                                             INFILE   CLOSE-FILE DROP                                        OUTFILE  FLUSH-FILE  CLOSE-FILE  OR                             IF ." Error closing " ERROR THEN ;                                                                                            \ Main                                                          : COPY ( -- )                                                     OPEN-FILES  COPY-ALL  CLOSE-FILES  BYE ;                                                                                                                                                                                                                                                                                                                                                      